"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=t(require("cors")),r=t(require("express")),n=t(require("readline")),o=require("ramda"),i=t(require("inquirer")),a=t(require("fuzzy")),s=require("path-to-regexp"),u=require("fs"),l=require("path"),p=require("http-proxy-middleware"),c=t(require("chalk")),h=require("apollo-server-express"),d=function(){return(d=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function f(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r((function(e){e(t.value)})).then(a,s)}u((n=n.apply(t,e||[])).next())}))}function v(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function y(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}var g=function(){function t(){this.executeEvent=this.executeEvent.bind(this),this.onKeyPress=this.onKeyPress.bind(this),this.listeners=[{key:"q",control:!1,event:process.exit},{key:"c",control:!0,event:process.exit}]}return t.prototype.filterInputListener=function(t,e){return e.key===t.name&&e.control===t.ctrl},t.prototype.onKeyPress=function(t,e){var r=this;this.listeners.filter((function(t){return r.filterInputListener(e,t)})).forEach(this.executeEvent)},t.prototype.isPromise=function(t){return Boolean(t.then)},t.prototype.executeEvent=function(t){var e=this;this.unbindKeypress();var r=t.event();r&&this.isPromise(r)?r.then((function(){e.reopenStdinAfterInquirer()})):this.bindKeypress()},t.prototype.reopenStdinAfterInquirer=function(){n.emitKeypressEvents(process.stdin),"function"==typeof process.stdin.setRawMode&&process.stdin.setRawMode(!0),process.stdin.resume(),this.bindKeypress()},t.prototype.bindKeypress=function(){process.stdin.on("keypress",this.onKeyPress)},t.prototype.unbindKeypress=function(){process.stdin.off("keypress",this.onKeyPress)},t.prototype.init=function(t){void 0===t&&(t=!0),n.emitKeypressEvents(process.stdin),"function"==typeof process.stdin.setRawMode&&process.stdin.setRawMode(t),this.bindKeypress()},t.prototype.addListener=function(t,e,r){void 0===r&&(r=!1);var n={key:t,event:e,control:r};this.listeners.push(n)},t}();i.registerPrompt("autocomplete",require("inquirer-autocomplete-prompt"));var m,w=function(t){return function(e){return void 0===e&&(e=""),a.filter(e,t).map(o.prop("original"))}};function x(t){var e=w(t);return i.prompt([{type:"autocomplete",name:"url",message:"Search for the endpoint URL:",source:function(t,r){return Promise.resolve(e(r))}}])}function b(t){var e=w(t);return i.prompt([{type:"autocomplete",name:"name",message:"Select the override settings:",source:function(t,r){return Promise.resolve(e(r))}}])}!function(t){t.GET="get",t.POST="post",t.PUT="put",t.DELETE="delete",t.PATCH="patch"}(m||(m={}));var M=m;function P(t){return t.isFile()}function S(t){return".json"===l.extname(t)?function(t){return JSON.parse(u.readFileSync(t).toString())}(t):u.readFileSync(t)}function R(t,e,r){var n=r?e+"--"+r:e,o=u.readdirSync(t,{withFileTypes:!0}).filter(P).filter((function(t){return function(t,e){return l.parse(e.name).name===t}(n,t)}))[0];if(!o)throw new Error("Fixture not found");return l.join(t,o.name)}function C(t,e){var r=l.dirname(t),n=l.basename(t),o=l.join("data",r),i=l.join("data",t);try{return R(i,"index",e)}catch(t){return R(o,n,e)}}function E(t,e){return S(C(t,e))}function q(t,e,r){var n=l.extname(t);try{return n?S(t):E(t,r)}catch(n){if(e)try{return E(e,r)}catch(t){console.error("You probably forgot to create the fallback fixture file",e,t)}else console.error("You probably forgot to create the fixture file.",t,n)}}var D=o.sortBy(o.compose(o.toLower,o.prop("path"))),I=function(t,e){return"<div>"+D(y(t)).map(function(t){return function(e){var r=e.path.replace(/^\//,"");return"<div>\n    <span>"+function(t){return"["+t.methods.map((function(t){return t.type.toUpperCase()})).join(", ")+"]"}(e)+' </span>\n    <a href="'+t+"/"+r+'">'+r+"</a>\n  </div>"}}(e)).join("")+"</div>"};function T(t){return t.map(o.prop("path"))}function O(t){return t.toUpperCase()}function A(t,e){var r=t.find((function(t){var r=t.path;return s.match(r)(e)}));if(r)return r;throw new Error('Route with url "'+e+'" not found')}function k(t,e){var r=t.find(o.propEq("type",e.toLowerCase()));if(r)return r;throw new Error('Method with type "'+e+'" not found')}function L(t,e){return"function"==typeof t?t(e):t}function N(t){return function(e){var r=y(e.overrides||[],function(t){return t.map((function(t){return d(d({},t),{name:t.name+" (Global)"})}))}(t));return d(d({},e),{overrides:r})}}function z(t,e){return e.path.replace(t.basePath||"","")}var B=function(){function t(t){void 0===t&&(t=[]),this.globalOverrides=t,this.routes=[]}return t.prototype.findRouteByPath=function(t){return A(this.routes,t)},t.prototype.findRouteMethod=function(t,e){return k(this.findRouteByPath(t).methods,e)},t.prototype.getAll=function(){return this.routes},t.prototype.setAll=function(t){for(var e=this,r=function(t,e){return void 0===e&&(e=[]),e.length?t.map((function(t){var r=t.methods.map(N(e));return d(d({},t),{methods:r})})):t}(t,this.globalOverrides);this.routes.length>0;)this.routes.pop();r.forEach((function(t){e.routes.push(t)}))},t.prototype.addDocsRoute=function(t,e){void 0===t&&(t=""),void 0===e&&(e=""),this.routes.push({path:e,methods:[{type:M.GET,headers:{"Content-Type":"text/html"},data:I(this.routes,t)}]})},t.prototype.createResolvedRouteMiddleware=function(t){var e=this;return function(r,n,o){var i=r.method,a=z(t,r);try{var s=e.findRouteByPath(a),u=k(s.methods,i);n.locals.route=s,n.locals.routeMethod=u}catch(t){return n.status(404).send("Not found")}o()}},t.prototype.createRouteMethodResponseMiddleware=function(t){return function(e,r,n){var o=r.locals,i=o.route,a=o.routeMethod,s=L(a.data,e),u=L(a.file,e),l=z(t,e),p=s||q(u||l,i.path,a.scenario);r.locals.response=p,n()}},t}(),j=o.complement(o.either(o.isNil,o.isEmpty));function K(t){return y(["Default"],function(t){return t.map(o.prop("name"))}(t))}function G(t,e){var r=k(t.methods,e).overrides;if(r)return r;throw new Error('Method with type "'+e+'" has no "overrides"')}function Q(t){return t.filter(o.propSatisfies(j,"overrides"))}function F(t){var e;return null===(e=t.overrides)||void 0===e?void 0:e.find(o.propSatisfies(o.equals(!0),"selected"))}var H=function(){function t(t,e){this.routeManager=t,this.fileStorage=e}return t.prototype.applyExternalOverrides=function(){var t,e,r=this;if((null===(t=this.fileStorage)||void 0===t?void 0:t.options.enabled)&&this.fileStorage.isInitialized())if(this.fileStorage.isEmpty())null===(e=this.fileStorage)||void 0===e||e.setItem("overrides",this.getAllSelected());else{var n=this.fileStorage.getItem("overrides");null==n||n.forEach((function(t){var e=G(A(r.getAll(),t.routePath),t.methodType.toLowerCase()),n=t.name;e.forEach((function(t){t.selected=t.name===n}))}))}},t.prototype.getAll=function(){return this.routeManager.getAll().filter(o.pipe(o.propOr([],"methods"),Q,j))},t.prototype.getAllSelected=function(){return this.routeManager.getAll().reduce((function(t,e){return e.methods.forEach((function(r){var n=F(r);n&&t.push({routePath:e.path,methodType:r.type,name:n.name})})),t}),[])},t.prototype.choose=function(){var t;return f(this,void 0,void 0,(function(){var e,r,n,a,s,u,l;return v(this,(function(p){switch(p.label){case 0:return[4,x(T(e=this.getAll()))];case 1:return r=p.sent().url,n=A(e,r),a=function(t){return Q(t.methods).map(o.pipe(o.prop("type"),O))}(n),[4,(c=a,h=w(c),i.prompt([{type:"autocomplete",name:"type",message:"Select the type:",source:function(t,e){return Promise.resolve(h(e))}}]))];case 2:return s=p.sent().type,[4,b(K(u=G(n,s.toLowerCase())))];case 3:return l=p.sent().name,u.forEach((function(t){t.selected=t.name===l})),null===(t=this.fileStorage)||void 0===t||t.setItem("overrides",this.getAllSelected()),[2,{routePath:r,methodType:s,name:l}]}var c,h}))}))},t.prototype.createOverriddenRouteMethodMiddleware=function(){return function(t,e,r){var n=e.locals.routeMethod,o=F(n);o&&(e.locals.routeMethod=d(d({},n),o)),r()}},t.prototype.createOverriddenRouteContentMiddleware=function(){return function(t,e,r){var n=e.locals,o=n.response,i=n.routeMethod.overrideContent;i&&(e.locals.response=i(t,o)),r()}},t}();var J=function(){function t(t,e,r){void 0===e&&(e=[]),this.routeManager=t,this.currentProxyIndex=null,this.proxies=e.map((function(t){return function(t,e){var r=t.appendBasePath,n=t.name,o=t.host,i=(t.onProxyReq,t.onProxyRes);return{host:o,name:n,handler:p.createProxyMiddleware(d(d({},t),{target:o,pathRewrite:function(t){return r?t:t.replace(e||"","")},changeOrigin:!0,onProxyReq:function(e,r,n,o){var i;null===(i=t.onProxyReq)||void 0===i||i.call(t,e,r,n,o),p.fixRequestBody(e,r)},onProxyRes:i}))}}(t,r)}))}return t.prototype.getProxyNames=function(){return this.proxies.map(o.prop("name"))},t.prototype.getAllNamesWithDefault=function(){return y(["Local"],this.getProxyNames())},t.prototype.findByName=function(t){return this.proxies.find(o.propEq("name",t))},t.prototype.resolveRouteProxyHandler=function(t){var e;return null===(e=t.proxy)||void 0===e?void 0:e.handler},t.prototype.isRouteProxyOverridenToDefault=function(t){return null===t.proxy},t.prototype.resolveGlobalProxyHandler=function(){var t=this.getCurrent();return null==t?void 0:t.handler},t.prototype.getAll=function(){return this.proxies},t.prototype.getCurrent=function(){return null!==this.currentProxyIndex?this.proxies[this.currentProxyIndex]:null},t.prototype.getOverriddenProxyRoutes=function(){var t=this.getCurrent();return this.routeManager.getAll().filter(o.both(o.propSatisfies(o.complement(o.equals(void 0)),"proxy"),o.pathSatisfies(o.complement(o.equals(null==t?void 0:t.name)),["proxy","name"])))},t.prototype.toggleCurrent=function(){null===this.currentProxyIndex?this.currentProxyIndex=0:this.currentProxyIndex===this.proxies.length-1?this.currentProxyIndex=null:this.currentProxyIndex+=1},t.prototype.chooseRouteProxy=function(){return f(this,void 0,void 0,(function(){var t,e,r;return v(this,(function(n){switch(n.label){case 0:return[4,x(T(this.routeManager.getAll()))];case 1:return t=n.sent().url,[4,(o=this.getAllNamesWithDefault(),a=w(o),i.prompt([{type:"autocomplete",name:"proxy",message:"Select the proxy:",source:function(t,e){return Promise.resolve(a(e))}}]))];case 2:return e=n.sent().proxy,(r=A(this.routeManager.getAll(),t)).proxy=this.findByName(e)||null,[2,r]}var o,a}))}))},t.prototype.createRouteMiddleware=function(){var t=this;return function(e,r,n){var o=r.locals.route,i=t.resolveRouteProxyHandler(o);if(i)return i(e,r,n);n()}},t.prototype.createGlobalMiddleware=function(){var t=this;return function(e,r,n){var o,i=t.resolveGlobalProxyHandler();return(null===(o=r.locals)||void 0===o?void 0:o.route)&&t.isRouteProxyOverridenToDefault(r.locals.route)?n():i?i(e,r,n):void n()}},t}();function U(t){return function(e,r,n){var o,i=e.query,a=r.locals,s=a.response,u=a.routeMethod.pagination;if(u){var l=function(t,e){var r="boolean"==typeof t?e.pagination:d(d({},e.pagination),t);return{count:(null==r?void 0:r.count)||"count",data:(null==r?void 0:r.data)||"data",empty:(null==r?void 0:r.empty)||"empty",first:(null==r?void 0:r.first)||"first",headers:(null==r?void 0:r.headers)||!1,last:(null==r?void 0:r.last)||"last",next:(null==r?void 0:r.next)||"next",offsetParameter:(null==r?void 0:r.offsetParameter)||"offset",page:(null==r?void 0:r.page)||"page",pageParameter:(null==r?void 0:r.pageParameter)||"page",pages:(null==r?void 0:r.pages)||"pages",sizeParameter:(null==r?void 0:r.sizeParameter)||"size",total:(null==r?void 0:r.total)||"total"}}(u,t),p=function(t,e,r){var n,o=Number(e[t.sizeParameter])||5,i=e[t.offsetParameter]?Number(e[t.offsetParameter])/o:Number(e[t.pageParameter]),a=r.length,s=Math.ceil(a/o),u=s-1,l=i*o,p=r.slice(l,l+o);return{data:p,metadata:((n={})[t.empty]=0===p.length,n[t.first]=0===i,n[t.last]=i>=u,n[t.next]=i<u,n[t.page]=i,n[t.pages]=s,n[t.count]=o,n[t.total]=a,n)}}(l,i,s),c=p.data,h=p.metadata;l.headers?(r.set(h),r.locals.response=c):r.locals.response=d(((o={})[l.data]=c,o),h)}n()}}var W=function(){function t(t){void 0===t&&(t=[]),this.currentThrottlingIndex=null,this.throttlings=t}return t.prototype.resolveRouteDelay=function(t){return t.delay||this.getCurrentDelay()},t.prototype.getAll=function(){return this.throttlings},t.prototype.getCurrent=function(){return null!==this.currentThrottlingIndex?this.throttlings[this.currentThrottlingIndex]:null},t.prototype.getCurrentDelay=function(){var t=(this.getCurrent()||{values:[0,0]}).values,e=t[0],r=t[1];return Math.ceil(Math.random()*(e-r)+r)},t.prototype.toggleCurrent=function(){null===this.currentThrottlingIndex?this.currentThrottlingIndex=0:this.currentThrottlingIndex===this.throttlings.length-1?this.currentThrottlingIndex=null:this.currentThrottlingIndex+=1},t.prototype.createMiddleware=function(){var t=this;return function(e,r,n){var o=r.locals.routeMethod;setTimeout(n,t.resolveRouteDelay(o))}},t}();function Y(t,e){return O(e)+" "+t}var _=function(){function t(t,e,r,o){this.proxyManager=t,this.throttlingManager=e,this.overrideManager=r,this.fileStorage=o,this.display=n.createInterface({input:process.stdin,output:process.stdout}),this.proxyManager=t,this.throttlingManager=e,this.overrideManager=r}return t.prototype.write=function(t){this.display.write(t)},t.prototype.clear=function(){this.write("[2J"),this.write("[0f")},t.prototype.linebreak=function(){this.write("\r\n")},t.prototype.line=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(t.join(" ")),this.write("\r\n")},t.prototype.paragraph=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.line.apply(this,y([" "],t))},t.prototype.printConnection=function(){var t=this.proxyManager.getCurrent();this.line(c.blackBright("Connection:")),t?this.paragraph(c.bold.white(t.name),c.bold.blackBright(t.host)):this.paragraph("Local")},t.prototype.printConnectionOverrides=function(){var t=this;this.line(c.blackBright("Connection overrides:"));var e=this.proxyManager.getOverriddenProxyRoutes();e.length?e.forEach((function(e){var r;return t.paragraph("- "+e.path+": "+((null===(r=e.proxy)||void 0===r?void 0:r.name)||"Local"))})):this.paragraph("None")},t.prototype.printThrottling=function(){var t=this.throttlingManager.getCurrent();this.line(c.blackBright("Throttling:")),t?this.paragraph(c.bold.white(t.name),c.bold.black(t.values[0]),c.bold.black("-"),c.bold.black(t.values[1]),c.bold.black("ms")):this.paragraph("Disabled")},t.prototype.printOverrides=function(){var t=this;this.line(c.blackBright("Overrides:"));var e=this.overrideManager.getAllSelected();e.length?e.forEach((function(e){var r=e.routePath,n=e.methodType,o=e.name;return t.paragraph("- "+Y(r,n)+": "+o)})):this.paragraph("None")},t.prototype.printAvailableCommands=function(){var t;this.line("Available commands:"),this.paragraph("- "+c.bold.white("c")+" to toggle the connection"),this.paragraph("- "+c.bold.white("t")+" to toggle the throttling"),this.paragraph("- "+c.bold.white("o")+' to change endpoint settings according to "overrides"'),this.paragraph("- "+c.bold.white("p")+" to toggle the connection to an endpoint"),this.paragraph("- "+c.bold.white("q")+" to stop and quit the service"),(null===(t=this.fileStorage)||void 0===t?void 0:t.options.enabled)&&this.paragraph("- "+c.bold.white("x")+" to reset file storage permanently (restart to apply changes)"),this.linebreak()},t.prototype.drawDashboard=function(){this.clear(),this.line(c.bold.green("The service is running!")),this.printConnection(),this.printConnectionOverrides(),this.printThrottling(),this.printOverrides(),this.printAvailableCommands()},t.prototype.createDrawRequestMiddleware=function(){var t=this;return function(e,r,n){var o=t.throttlingManager.getCurrent(),i=t.throttlingManager.getCurrentDelay();t.line(c.bold.white(e.method+" "+e.path)),o&&t.line(c.blackBright("["+i+"ms]")),n()}},t.prototype.drawMethodOverrideChanged=function(t,e,r){var n=c.magenta(Y(t,e)),o=c.magenta(r);this.display.write("Endpoint "+n+" changed to response "+o),this.linebreak()},t.prototype.drawRouteProxyChanged=function(t,e){var r=c.magenta(t),n=c.magenta(e);this.display.write("Route "+r+" changed to proxy "+n),this.linebreak()},t}();function V(t){return function(e,r,n,o){var i=o.fieldName;return q(t+i+".json")}}function X(t,e){var r,n=e.name.value;return d(d({},t),((r={})[n]=V("graphql/queries/"),r))}function Z(t,e){var r,n=e.name.value;return d(d({},t),((r={})[n]=V("graphql/mutations/"),r))}function $(t){return"Query"===t.name.value}function tt(t){return"Mutation"===t.name.value}var et=function(){function t(t){this.typeDefs=h.gql(t)}return t.prototype.hasQueryDefinitions=function(){return!!this.typeDefs.definitions.find($)},t.prototype.getGraphQLQueries=function(){return this.typeDefs.definitions.find($)},t.prototype.hasMutationDefinitions=function(){return!!this.typeDefs.definitions.find(tt)},t.prototype.getGraphQLMutations=function(){return this.typeDefs.definitions.find(tt)},t.prototype.generateQueriesAndMutations=function(t){var e=d(d({},t),{resolvers:{}});return this.hasQueryDefinitions()&&(e.resolvers.Query=this.getGraphQLQueries().fields.reduce(X,{})),this.hasMutationDefinitions()&&(e.resolvers.Mutation=this.getGraphQLMutations().fields.reduce(Z,{})),e},t.prototype.applyMiddlewareTo=function(t){var e={typeDefs:this.typeDefs},r=this.generateQueriesAndMutations(e),n=new h.ApolloServer(r),o={app:t};return n.applyMiddleware(o),n},t}(),rt={},nt={enabled:!1},ot=function(){function t(t){var e;void 0===t&&(t=nt),this.options=t,this.fs=null!==(e=this.options.fs)&&void 0!==e?e:u,t.enabled&&this.initializeStorage()}return t.prototype.isEmpty=function(){return 0===Object.keys(this.getStorage()).length},t.prototype.isInitialized=function(){try{return!(!this.options.enabled||!this.options.path)&&(this.fs.readFileSync(this.options.path,"utf-8"),!0)}catch(t){return!1}},t.prototype.getItem=function(t){if(this.isInitialized())return this.getStorage()[t]},t.prototype.setItem=function(t,e){if(this.isInitialized()){var r=this.getStorage();r[t]=e,this.options.path&&this.persist(r)}},t.prototype.clear=function(){this.persist(rt)},t.prototype.persist=function(t){this.options.path&&this.fs.writeFileSync(this.options.path,JSON.stringify(t,null,2))},t.prototype.getStorage=function(){var t=this.getSerializedStorage();try{return JSON.parse(t)}catch(t){throw new Error("Invalid file storage content")}},t.prototype.initializeStorage=function(){if(!this.options.path)throw new Error("FileStorage path option is missing");this.isInitialized()||this.persist(rt)},t.prototype.getSerializedStorage=function(){try{return this.options.path?this.fs.readFileSync(this.options.path,"utf-8"):"{}"}catch(t){if("ENOENT"!==t.code)throw t;return this.initializeStorage(),this.getSerializedStorage()}},t}();exports.MethodType=M,exports.createServer=function(t){void 0===t&&(t={});var n=t.basePath,o=void 0===n?"":n,i=t.docsRoute,a=void 0===i?"":i,s=t.definitions,u=t.middlewares,p=t.overrides,c=t.proxies,h=t.throttlings,d=t.fileStorageOptions,y=new ot(d),m=new B(p),w=new H(m,y),x=new J(m,c,o),b=new W(h),M=new _(x,b,w,y),P=r();function S(t,e){var r=e.locals,n=r.response,o=r.routeMethod,i=o.code,a=void 0===i?200:i,s=L(o.headers,t);e.set(s).status(a),Number.isInteger(n)?e.send(n.toString()):e.send(n)}function R(e){e.methods.forEach((function(r){return function(e,r){var n=e.path,i=r.type;P[i](l.join(o,n),m.createRouteMethodResponseMiddleware(t),(function(t,e,r){var n=t.query,o=e.locals,i=o.response,a=o.routeMethod,s=a.search,u=a.search,l=(void 0===u?{}:u).parameter,p=n[void 0===l?"search":l];s&&p&&(e.locals.response=function(t,e,r){return r.filter((function(r){return function(t,e,r){var n=t.parameter;return t.properties.find((function(t){return function(t,e,r,n){return e[n]&&e[n].toLowerCase().includes(t[r].toLowerCase())}(e,r,n,t)}))}(t,e,r)}))}(s,n,i)),r()}),U(t),w.createOverriddenRouteContentMiddleware(),S)}(e,r)}))}return s&&new et(s).applyMiddlewareTo(P),P.use(u||e()),P.use(M.createDrawRequestMiddleware(),m.createResolvedRouteMiddleware(t),x.createRouteMiddleware(),w.createOverriddenRouteMethodMiddleware(),b.createMiddleware(),x.createGlobalMiddleware()),{routes:function(t){m.setAll(t),m.addDocsRoute(o,a),m.getAll().forEach(R),w.applyExternalOverrides()},listen:function(t){void 0===t&&(t=8080);var e=new g;e.init(!0),M.drawDashboard(),e.addListener("c",(function(){x.toggleCurrent(),M.drawDashboard()})),e.addListener("t",(function(){b.toggleCurrent(),M.drawDashboard()})),e.addListener("o",(function(){return f(this,void 0,void 0,(function(){var t,e,r,n;return v(this,(function(o){switch(o.label){case 0:return[4,w.choose()];case 1:return t=o.sent(),e=t.routePath,r=t.methodType,n=t.name,M.drawDashboard(),M.drawMethodOverrideChanged(e,r,n),[2]}}))}))})),e.addListener("p",(function(){var t;return f(this,void 0,void 0,(function(){var e;return v(this,(function(r){switch(r.label){case 0:return[4,x.chooseRouteProxy()];case 1:return e=r.sent(),M.drawDashboard(),M.drawRouteProxyChanged(e.path,(null===(t=e.proxy)||void 0===t?void 0:t.name)||"Local"),[2]}}))}))})),y.options.enabled&&e.addListener("x",(function(){return f(this,void 0,void 0,(function(){return v(this,(function(t){return y.clear(),M.drawDashboard(),[2]}))}))})),P.listen(t)}}};
//# sourceMappingURL=index.js.map
